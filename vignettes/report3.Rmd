---
title: "SaferActive Report 3"
author: Institute for Transport Studies
output:
  bookdown::html_vignette2:
    number_sections: true
    toc: true
vignette: >
  %\VignetteIndexEntry{SaferActive Report 3}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: saferactive.bib
pkgdown:
  as_is: true
  set_null_theme: false
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

```{r setup}
library(trafficalmr)
```

# Introduction

# Risk modelling

## Assigning collision data to a spatial grid {#collision}

## Assigning census-derived cycling data to a spatial grid

To estimate the spatial distribution of cycling activity, measured in km per year, we started with data from the Propensity to Cycle Tool (PCT). 
The Route Network layer in the PCT provides an indication of the number of commuter cyclists on different parts of the network, based on 2011 Census data reporting the number of people travelling between small (LSOA, average population \~2000) zones by mode of travel. 
The route network in the PCT represents the 'fastest' routes for cycling between these LSOA zones and is not therefore designed to represent where cycling takes place (there are may be some links on the route network where the people prefer a slower but safer route).

Converting the spatial network representation of cycling to a spatial grid has the advantage of 'smoothing' out cycling activity across cities and allowing cycling levels to be presented in a form that is directly comparable with the crash data, which as also assigned to the spatial grid, as described in Section \@ref(collision). 
The three main steps were:

-   Break-up long route network segments so that only segments with a length of 200 m or less remained. 
To do this we initially solved the problem in R, developing the function [`line_breakup()`](https://docs.ropensci.org/stplanr/reference/line_breakup.html) in the `stplanr` package for the purpose. 
After realising that this implementation would take several hours to complete on the national route network, we opted for a more computationally efficient approach that used R's interface to GIS algorithms in the `qgisprocess` package.
-   Calculate the distance cycled, in km per year, on each of the shortened segments on the updated route networks as follows: $$
    d_y = t_s * t_y * d_s
    $$ where $d_y$ is distance cycled per year per segment, $t_s$ is the number of trips per segment, $t_y$ is the number of trips in either direction made, on average, per year and $d_s$ is the distance of each segment. 
    $t_s$ and $d_s$ are taken directly from the PCT and $t_y$ was set to 253 commute trips per day multiplied by two, based on guidance from @departmentfortransport_active_2020 and based on the fact that the PCT counts only record cycling flows in one direction. 
    [Summing](https://github.com/saferactive/saferactive/blob/master/code/rasters-rnet.R#L56) these values for all route network segments across England and Wales yielded a total of 1.1 billion km cycled in 2011, roughly a quarter of the 4.5 billion km cycled by any mode in England and Wales according to the National Travel Survey (see table NTS0303 and analysis in the script [`nts-national-distance-cycled-year.R`](https://github.com/saferactive/saferactive/blob/master/code/nts-national-distance-cycled-year.R) for details).
-   Add the total distance cycled of each segment per grid cell, based on the centre point (centroid) of each segment of 200 m or less.

The results are shown in Figure \@ref(fig:cycled-yr).

```{r cycled-yr, fig.cap="Estimates of distance cycled per year (thousand km per year of cycle commuting distance) passing through each 500 m grid cell, based on analysis of Census data on the route network from the PCT, for a rural area (Herefordshire, left) and an urban area (London, right).", out.width="40%", fig.show='hold'}
# see https://github.com/saferactive/saferactive/issues/48
knitr::include_graphics(c(
  "https://camo.githubusercontent.com/4404fcf913b19c521aa249cd14e8b047c8a2a646/68747470733a2f2f692e696d6775722e636f6d2f57596b6c59476a2e706e67",
  "https://user-images.githubusercontent.com/1825120/97345445-fed2ae80-1881-11eb-8b1e-18553c1805c1.png"
))
```


## Modelling spatio-temporal change in cycling uptake based on count data

## Validation of cycling uptake model results

## Modelling spatio-temporal change in collision risk

# Scenarios of change

## Traffic calming measures

## 20 mph zones

## Protected cycleways

## Traffic reduction

## Roadspace reallocation

## Low Traffic Neighbourhoods

# Data visualisation

# Web development

# Next steps

# References
